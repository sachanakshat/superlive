"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{6817:(e,t,r)=>{r.r(t),r.d(t,{default:()=>L});var a=r(4568),s=r(7620);let l=(0,r(6671).F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),n=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,...o}=e;return(0,a.jsx)("button",{className:l({variant:s,size:n,className:r}),ref:t,...o})});n.displayName="Button";var o=r(4338);let i=o.env.NEXT_PUBLIC_UPLOAD_SERVICE_URL||"http://localhost:8080";o.env.NEXT_PUBLIC_CATALOG_SERVICE_URL;let d=o.env.NEXT_PUBLIC_ENCODING_SERVICE_URL||"http://localhost:8082",c=async e=>{let t=new FormData;t.append("file",e);let r=await fetch("".concat(i,"/upload"),{method:"POST",body:t});if(!r.ok)throw Error("Upload failed: ".concat(r.statusText));return r.json()},m=async e=>{let t=await fetch("".concat(d,"/encode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_file:e})});if(!t.ok)throw Error("Failed to submit encoding job: ".concat(t.statusText));return t.json()},u=async()=>{let e=await fetch("".concat(d,"/streams"));if(!e.ok)throw Error("Failed to fetch video streams: ".concat(e.statusText));return e.json()},x=e=>{if(e)return e.startsWith("/dash/")||e.startsWith("/hls/")?"".concat(d).concat(e):e};var h=r(8872);let f=e=>{let{onUploadComplete:t,onError:r}=e,[l,o]=(0,s.useState)(!1),[i,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(0),x=s.useRef(null),f=async e=>{if(!e.type.startsWith("video/")){null==r||r(Error("Please upload a video file"));return}try{d(!0),u(0);let r=setInterval(()=>{u(e=>{let t=e+10*Math.random();return t>90?90:t})},500),a=await c(e);clearInterval(r),u(100),d(!1),null==t||t(a)}catch(e){d(!1),null==r||r(e instanceof Error?e:Error("Upload failed"))}};return(0,a.jsxs)("div",{className:"relative flex h-64 w-full flex-col items-center justify-center rounded-lg border-2 border-dashed p-6 transition-colors ".concat(l?"border-primary bg-primary/5":"border-border"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),o(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),o(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),o(!1);let t=e.dataTransfer.files;t.length>0&&f(t[0])},children:[(0,a.jsx)("input",{ref:x,type:"file",accept:"video/*",onChange:e=>{e.target.files&&e.target.files.length>0&&f(e.target.files[0])},className:"hidden"}),(0,a.jsx)(h.A,{className:"mb-4 h-12 w-12 ".concat(l?"text-primary":"text-muted-foreground")}),(0,a.jsx)("h3",{className:"mb-2 text-lg font-medium",children:i?"Uploading...":"Drag & Drop Video"}),(0,a.jsx)("p",{className:"mb-4 text-center text-sm text-muted-foreground",children:i?"".concat(m.toFixed(0),"% complete"):"Or click to browse your files"}),i?(0,a.jsx)("div",{className:"mt-2 h-2 w-full overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)("div",{className:"h-full bg-primary transition-all duration-300",style:{width:"".concat(m,"%")}})}):(0,a.jsx)(n,{onClick:()=>{var e;null==(e=x.current)||e.click()},disabled:i,variant:"outline",children:"Select Video"})]})};var p=r(1773);let v=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:"rounded-lg border bg-card text-card-foreground shadow-sm ".concat(r),...s})});v.displayName="Card";let g=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:"flex flex-col space-y-1.5 p-6 ".concat(r),...s})});g.displayName="CardHeader";let j=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:"text-2xl font-semibold leading-none tracking-tight ".concat(r),...s})});j.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:"text-sm text-muted-foreground ".concat(r),...s})}).displayName="CardDescription";let b=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:"p-6 pt-0 ".concat(r),...s})});b.displayName="CardContent";let y=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:"flex items-center p-6 pt-0 ".concat(r),...s})});y.displayName="CardFooter";var N=r(9765),w=r(2487);let S=e=>{let{video:t,onPlay:r}=e,s=t.thumbnail||null;return(0,a.jsxs)(v,{className:"overflow-hidden transition-shadow hover:shadow-md",children:[(0,a.jsxs)("div",{className:"relative aspect-video bg-muted",children:[s?(0,a.jsx)(p.default,{src:s,alt:t.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-secondary",children:(0,a.jsx)(N.A,{className:"h-12 w-12 text-muted-foreground"})}),(0,a.jsx)("button",{className:"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 transition-opacity hover:opacity-100",onClick:()=>r(t),children:(0,a.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-primary text-primary-foreground",children:(0,a.jsx)(w.A,{className:"h-8 w-8"})})})]}),(0,a.jsx)(g,{className:"p-4 pb-0",children:(0,a.jsx)(j,{className:"line-clamp-1 text-lg",children:t.title})}),(0,a.jsx)(b,{className:"p-4 pt-2",children:(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Uploaded: ",new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]})}),(0,a.jsx)(y,{className:"p-4 pt-0",children:(0,a.jsxs)(n,{onClick:()=>r(t),className:"w-full",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Play Video"]})})]})};var E=r(5262),_=r(8352);let k=e=>{let{hlsUrl:t,dashUrl:r,title:l,className:n=""}=e,o=(0,s.useRef)(null),[i,d]=(0,s.useState)(null),[c,m]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=o.current;if(!e)return;m(!0),d(null);let a=null,s=null;return(async()=>{try{t?E.Ay.isSupported()?((a=new E.Ay({enableWorker:!0,lowLatencyMode:!0})).loadSource(t),a.attachMedia(e),a.on(E.Ay.Events.MANIFEST_PARSED,()=>{m(!1),e.play().catch(e=>{console.error("Error playing video:",e),d("Failed to play the video. Try clicking play.")})}),a.on(E.Ay.Events.ERROR,(e,t)=>{t.fatal&&(console.error("HLS error:",t),d("Error loading the video stream."))})):e.canPlayType("application/vnd.apple.mpegurl")?(e.src=t,e.addEventListener("loadedmetadata",()=>{m(!1),e.play().catch(e=>{console.error("Error playing video:",e),d("Failed to play the video. Try clicking play.")})})):d("Your browser does not support HLS playback."):r?((s=_.KJ().create()).initialize(e,r,!0),s.on(_.KJ.events.STREAM_INITIALIZED,()=>{m(!1)}),s.on(_.KJ.events.ERROR,e=>{console.error("DASH error:",e),d("Error loading the DASH stream.")})):d("No video source provided.")}catch(e){console.error("Video player setup error:",e),d("Failed to initialize the video player.")}})(),()=>{a&&a.destroy(),s&&s.reset()}},[t,r]),(0,a.jsxs)("div",{className:"relative overflow-hidden rounded-lg bg-black ".concat(n),children:[c&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}),i&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 p-4 text-center text-white",children:(0,a.jsx)("p",{children:i})}),(0,a.jsx)("video",{ref:o,className:"h-full w-full",controls:!0,playsInline:!0,poster:void 0,title:l})]})};var C=r(8276),D=r(3385);let R=e=>{let t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?"".concat(t,":").concat(r.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(r,":").concat(a.toString().padStart(2,"0"))},A=e=>{let{video:t,onBack:r}=e,s=t.hls_url?x(t.hls_url):x(t.dash_url),l=t.hls_url&&s===x(t.hls_url);return(0,a.jsxs)("div",{className:"container mx-auto max-w-6xl py-8",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsxs)(n,{variant:"ghost",onClick:r,className:"flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"h-4 w-4"}),"Back to videos"]}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:t.title}),(0,a.jsx)(n,{variant:"outline",asChild:!0,children:(0,a.jsxs)("a",{href:"/api/download?id=".concat(encodeURIComponent(t.original_file)),download:t.title,className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-4 w-4"}),"Download"]})})]}),(0,a.jsx)("div",{className:"overflow-hidden rounded-xl shadow-lg",children:(0,a.jsx)(k,{hlsUrl:l?s:void 0,dashUrl:l?void 0:s,title:t.title,className:"aspect-video w-full"})}),(0,a.jsxs)("div",{className:"mt-6 rounded-lg border bg-card p-4 shadow-sm",children:[(0,a.jsx)("h2",{className:"mb-2 text-xl font-semibold",children:"Video Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Original File"}),(0,a.jsx)("p",{className:"text-base",children:t.original_file})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Uploaded"}),(0,a.jsx)("p",{className:"text-base",children:new Date(t.created_at).toLocaleString()})]}),t.duration&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Duration"}),(0,a.jsx)("p",{className:"text-base",children:R(t.duration)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Streaming Format"}),(0,a.jsx)("p",{className:"text-base",children:l?"HLS":"MPEG-DASH"})]})]})]})]})};var T=r(1564),U=r(9690);function L(){let[e,t]=(0,s.useState)([]),[r,l]=(0,s.useState)(!0),[n,o]=(0,s.useState)(null),[i,d]=(0,s.useState)(null),[c,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{h()},[]);let h=async()=>{try{l(!0),o(null);let e=await u();t(e)}catch(e){o("Failed to load videos. Please try again later."),console.error("Error fetching videos:",e)}finally{l(!1)}},p=async e=>{try{x(null),await m(e.file_id),setTimeout(()=>{h()},1e3)}catch(e){x("File uploaded but encoding failed. Please try again."),console.error("Error submitting encoding job:",e)}},v=e=>{d(e)};return i?(0,a.jsx)(A,{video:i,onBack:()=>{d(null)}}):(0,a.jsxs)("div",{className:"container mx-auto max-w-7xl py-8",children:[(0,a.jsx)("h1",{className:"mb-8 text-center text-4xl font-bold",children:"SuperLive"}),(0,a.jsxs)("section",{className:"mb-12",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center",children:[(0,a.jsx)(T.A,{className:"mr-2 h-6 w-6"}),(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"Upload Video"})]}),(0,a.jsx)(f,{onUploadComplete:p,onError:e=>{x(e.message)}}),c&&(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-2 rounded-md bg-destructive/10 p-3 text-destructive",children:[(0,a.jsx)(U.A,{className:"h-5 w-5"}),(0,a.jsx)("p",{children:c})]})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"mb-6 text-2xl font-semibold",children:"Your Videos"}),r?(0,a.jsx)("div",{className:"flex min-h-40 items-center justify-center",children:(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):n?(0,a.jsx)("div",{className:"flex min-h-40 items-center justify-center rounded-lg border bg-card p-6 text-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(U.A,{className:"mx-auto mb-2 h-8 w-8 text-destructive"}),(0,a.jsx)("p",{children:n})]})}):0===e.length?(0,a.jsxs)("div",{className:"flex min-h-40 flex-col items-center justify-center rounded-lg border bg-card p-6 text-center",children:[(0,a.jsx)("p",{className:"mb-2 text-lg font-medium",children:"No videos available yet"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Upload a video to get started"})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.map(e=>(0,a.jsx)(S,{video:e,onPlay:v},e.id))})]})]})}}}]);